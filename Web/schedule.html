<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="language" content="en-us" />
    <meta name="description" content="Phantasm roleplaying convention held annualy in Peterborough Ontario Canada" />
    <meta name="keywords" content="Phantasm, roleplaying convention, role-playing convention, Phantasm roleplaying convention" />
    <meta name="robots" content="all" />
    <meta name="author" content="Sara Manning, Bryan McKellar" />
    <meta name="copyright" content="2018, Phantasm" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Events Schedule::Phantasm</title> 

    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="shortcut icon" href="images/favicon.ico" />

</head>
<body>
    <!-- banner -->
    <div class="center">
        <img src="images/phantasmtopperworking.jpg" alt="Phantasm roleplaying convention" />
    </div>

    <div class="container">
        <div class="row">
            <div class="col align-self-center">
                <div id="menu" ></div>
            </div>
        </div>
        <div class="row">
            <div class="col align-self-center">
                <h1>Events Schedule</h1>
                <p>Phantasm uses a <a href="content/Xcard.pdf" target="_blank">"X-Card"</a> at all of its tables. It is meant as a way to make players feel safe to play in an unfamiliar setting. If the card is tapped the GM may flip to the next scene, fade to black, or call a short break to be able to discuss things with the player, etc. Whatever they deem most appropriate for the moment. The GM is not expected to change the plot of their story, but consider incorporating alterations that do not effect plot, but lead to player comfort. This is not a democratic process.<br />
                <br />
                It gives everyone an easy out. An exit strategy. An easy way to say no without (or with less) peer pressure. The X-card creates a specific mood at the table. It says “We’re here together. If you need to stop, we’ll stop. The people playing are more important than the game we are playing.”<br />
                <br />
                This is by no means intended as a means of censorship nor to limit creativity at the table. Nor is it there to judge the GM. With the combination of all our gamers and stories, there are literally limitless situations that will occur. Some of those situations may trigger a memory or moment that is sensitive to the player. </p>
                <p>No outside food or drink allowed</p>
            </div>
        </div>
        <div class="row">
            <div class="col align-self-center">
                <h2>Games</h2>
            </div>
        </div>
        <!-- Selectors -->
        <div class="row">
            <div class="col ">
                <label for="sSlot">Time slot:</label><br />
                <select id="sSlot">
                    <option value="0">All Slots</option>
                </select>
            </div>
            <div class="col">
                <label for="sGame">Game:</label><br />
                <select id="sGame">
                    <option value="0">All Games</option>
                </select>
            </div>
            <div class="col">
                <label for="sStoryTeller">Story Teller:</label><br />
                <select id="sStoryTeller">
                    <option value="0">All Story Tellers</option>
                </select>
            </div>
        </div>
        <div class="row">
            <div class="col">
                <div id="dDay1" hidden>
                    <h2 id="hDay1"></h2>
                    <ul id="uDay1"></ul>
                    <div id="divSlot1">
                        <table class='table-responsive' id="tbSlot1">
                            <caption>
                                <span class="title" id="tbSlotName1"></span>
                            </caption>
                            <thead>
                                <tr>
                                    <th id="thGame1" width='20%' rowspan="2">Game</th>
                                    <th id="thGM1" width='40%'>Game Master</th>
                                    <th id="theTitle1" width='40%'>Title</th>
                                </tr>
                                <tr>
                                    <th id="thDescription1" colspan="2">Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                
                            </tbody>
                        </table>
                        <!-- Decorative Divider -->
                        <div class="center">
                            <img src='images/dragon_splitter.gif' alt='' />
                        </div>
                    </div>
                </div>
                <div id="dDay2">
                    <h2 id="hDay2"></h2>
                    <ul id="uDay"></ul>
                    <div id="divSlot2">
                        <table class='table-responsive' id="tbSlot2">
                            <caption>
                                <span class="title" id="tbSlotName2"></span>
                            </caption>
                            <thead>
                                <tr>
                                    <th id="thGame2" width='20%' rowspan="2">Game</th>
                                    <th id="thGM2" width='40%'>Game Master</th>
                                    <th id="theTitle2" width='40%'>Title</th>
                                </tr>
                                <tr>
                                    <th id="thDescription2" colspan="2">Description</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                        <!-- Decorative Divider -->
                        <div class="center">
                            <img src='images/dragon_splitter.gif' alt='' />
                        </div>
                    </div>

                    <div id="divSlot3">
                        <table class='table-responsive' id="tbSlot3">
                            <caption>
                                <span class="title" id="tbSlotName3"></span>
                            </caption>
                            <thead>
                                <tr>
                                    <th id="thGame3" width='20%' rowspan="2">Game</th>
                                    <th id="thGM3" width='40%'>Game Master</th>
                                    <th id="theTitle3" width='40%'>Title</th>
                                </tr>
                                <tr>
                                    <th id="thDescription3" colspan="2">Description</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                        <!-- Decorative Divider -->
                        <div class="center">
                            <img src='images/dragon_splitter.gif' alt='' />
                        </div>
                    </div>
                    <div id="divSlot4">
                        <table class='table-responsive' id="tbSlot4">
                            <caption>
                                <span class="title" id="tbSlotName4"></span>
                            </caption>
                            <thead>
                                <tr>
                                    <th id="thGame4" width='20%' rowspan="2">Game</th>
                                    <th id="thGM4" width='40%'>Game Master</th>
                                    <th id="theTitle4" width='40%'>Title</th>
                                </tr>
                                <tr>
                                    <th id="thDescription4" colspan="2">Description</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                        <!-- Decorative Divider -->
                        <div class="center">
                            <img src='images/dragon_splitter.gif' alt='' />
                        </div>
                    </div>
                </div>
                <div id="dDay3">
                    <h2 id="hDay3"></h2>
                    <ul id="uDay"></ul>
                    <div id="divSlot5">
                        <table class='table-responsive' id="tbSlot5">
                            <caption>
                                <span class="title" id="tbSlotName5"></span>
                            </caption>
                            <thead>
                                <tr>
                                    <th id="thGame5" width='20%' rowspan="2">Game</th>
                                    <th id="thGM5" width='40%'>Game Master</th>
                                    <th id="theTitle5" width='40%'>Title</th>
                                </tr>
                                <tr>
                                    <th id="thDescription5" colspan="2">Description</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                        <!-- Decorative Divider -->
                        <div class="center">
                            <img src='images/dragon_splitter.gif' alt='' />
                        </div>
                    </div>
                    <div id="divSlot6">
                        <table class='table-responsive' id="tbSlot6">
                            <caption>
                                <span class="title" id="tbSlotName6"></span>
                            </caption>
                            <thead>
                                <tr>
                                    <th id="thGame6" width='20%' rowspan="2">Game</th>
                                    <th id="thGM6" width='40%'>Game Master</th>
                                    <th id="theTitle6" width='40%'>Title</th>
                                </tr>
                                <tr>
                                    <th id="thDescription6" colspan="2">Description</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="row">
            <div class="col align-self-center">
                <div id="footer"></div>
            </div>
        </div>
    </div>
    <script type="text/javascript" src="js/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js" ></script>
    <script type="text/javascript" src="js/common.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $.ajax({
                type: "GET",
                url: "schedule.xml",
                dataType: "xml",
                success: parseXml
            });

            function parseXml(xml) {
                $(xml).find("day").each(function (index) {
                    var dayId = $(this).attr("id");
                    $("#dDay" + dayId).show();
                    $("#hDay" + dayId).append($(this).find("weekday").text());
                    $(this).find("note").each(function () {
                        var dayId = $(this).parent().attr("id");
                        $("#uDay" + dayId).append("<li><p align='left'>" + $(this).find("desc").text() + "</p></li>");
                    });

                    $(this).find("slot").each(function () {
                        var slotId = 'tbSlotName' + $(this).attr("id");
                        $("#" + slotId).append($(this).text());
                    });
                });

                $(xml).find("games").find("game").each(function () {
                    var slotId = $(this).attr("slot");
                    var gameId = $(this).attr("id");

                    $("#tbSlot" + slotId).find("tbody").append("<tr id='game" + gameId + "'>");
                    $("#game" + gameId).append("<td headers='thGame" + slotId + "' rowspan='2'>" + $(this).find("name").text());

                    $("#game" + gameId).append("<td headers='thGM1" + slotId + "' ><a href='#gm" + $(this).find("gamemaster").attr("gmID") + "'>" + $(this).find("gamemaster").text() + "</a>");
                    $("#game" + gameId).append("<td headers='thTitle" + slotId + "'>" + $(this).find("title").text());

                    $("#tbSlot" + slotId).append("<tr id='gameb" + gameId + "'>")
                    $("#gameb" + gameId).append("<td headers='thDescription" + slotId + "' colspan='2'>" + $(this).find("description").text());
                });

                // Populate list of Slots from XML
                $(xml).find("day").each(function (day) {
                    var aSlots = [];
                    var aDay = $(this).find("weekday").text();
                    var slotNames = $(this).find("slot").toArray();
                    var slotName;

                    slotNames.sort(function (a, b)
                    {
                        return (parseInt($(a).attr('id')) - parseInt($(b).attr('id')));
                    });

                    for(var i = 0; i < slotNames.length; i++)
                    {
                        slotName = aDay + ' ' + slotNames[i].firstChild.nodeValue;
                        aSlots.push(slotName);
                    }

                    for (var n = 0; n < aSlots.length; n++) {
                        $('#sSlot').append('<option value="' + (n + 1) + '">' + aSlots[n] + '</option>');
                    }

                });

                // Populate list of games from XML
                var aGames = [];
                var aNames = $(xml).find("games").find("name").toArray();
                var bFound;
                var cName;
                var cGame;

                for (var i = 0; i < aNames.length; i++) {
                    bFound = false;

                    for (var x = 0; x < aGames.length; x++) {

                        if (aGames[x] == aNames[i].firstChild.nodeValue) {
                            bFound = true;
                            break;
                        }
                    }

                    if (bFound == false) {
                        aGames.push(aNames[i].firstChild.nodeValue);
                    }
                }


                aGames.sort();
                for (var n = 0; n < aGames.length; n++) {

                    $('#sGame').append('<option value="' + (n + 1) + '">' + aGames[n] + '</option>');
                }


                // Populate List of Story Tellers
                var aST = [];
                var aSTNames = $(xml).find("gamemasters").find("name").toArray();

                for (var i = 0; i < aSTNames.length; i++) {
                    bFound = false;
                    try {
                        if (aSTNames[i].firstChild != null) {
                            for (var x = 0; x < aST.length; x++) {
                                if (aST[x] == aSTNames[i].firstChild.nodeValue) {
                                    bFound = true;
                                    break;
                                }
                            }

                            if (bFound == false) {
                                aST.push(aSTNames[i].firstChild.nodeValue);
                            }
                        }
                    }
                    catch (err) {
                        alert(err.message);
                    }
                }

                aST.sort();
                for (var n = 0; n < aST.length; n++) {
                    $('#sStoryTeller').append('<option value="' + (n + 1) + '">' + aST[n] + '</option> ');
                }


                $('#sSlot').change(function () {
                    showData();
                });

                $('#sGame').change(function () {
                    showData();
                });

                $('#sStoryTeller').change(function () {
                    showData();
                });
            }



            function showData() {
                var nSlot = $('#sSlot').val();
                var sGame = $('#sGame').children(':selected').text();
                var nST = $('#sStoryTeller').children(':selected').text();

                // Show\Hide Slots
                if (nSlot == 0) {

                    $('div[id^="divSlot"]').show();

                } else {
                    $('div[id^="divSlot"]').hide();
                    $('div[id^="divSlot"]').each(function () {
                        var slotName = 'divSlot' + nSlot;

                        if ($(this).attr('id') == slotName) {
                            $(this).show();
                        }
                    });
                }

                // Show\Hide Games
                if ($('#sGame').val() == 0 && $('#sStoryTeller').val() == 0) {
                    $('tr[id^="game"]').show();
                } else {
                    $('tr[id^="game"]').hide();
                    $('tr[id^="game"]').each(function () {
                        var testGame = $(this).find('td:first').text();
                        var testST = $(this).find('td:first').next().text();
                        var cellID = '#gameb' + $(this).attr('id').substring(4);

                        if ((sGame == testGame && nST == testST) || (sGame == testGame && $('#sStoryTeller').val() == 0) || ($('#sGame').val() == 0 && nST == testST)) {
                            $(this).show();
                            $(cellID).show();
                        }
                    });
                }

            }
        });
    </script>
    <input type="hidden" id="pageRef" value="#l_schedule" />
</body>
</html>